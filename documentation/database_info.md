# Database Structure & Info
The MySQL database that pymm uses is intended to log [PREMIS](http://www.loc.gov/standards/premis/v3/) events that are taken on objects being ingested, as well as basic info about each object. There is also going to be (not done as of 7/2018) a module to parse and log the contents of an index.schema file generated when writing to an LTFS-formatted Linear Tape Open tape.

This structure is 99% taken from [mediamicroservices](https://github.com/mediamicroservices/mm) with a few minor modifications to suit our local needs and also my whimsy.

## Tables
There are 6 tables, 5 of which are expected to be in use.

|  Tables in pymm | Purpose |
| ------------ |---|
| event|logs PREMIS events|
| fingerprints| records perceptual hash data (not currently used)|
| fixity|records fixity data about objects|
| ltoSchema|logs LTO tape contents (not done)|
| object | authority table for ingested objects |
| objectCharacteristics | records technical metadata about objects |

### event
|  field name | purpose  | data example  |
| ------------ | ------------ | ------------ |
|  eventIdentifierValue | unique id  | 42  |
|  objectIdentifierValueID | unique ID from `object` table  | 118  |
| objectIdentifierValue  | basically the filename (from `object` table)  | filename.ext  |
|  eventType | event type taken (mostly) from LOC controlled vocab  | ingestion start  |
| eventDateTime  |  timestamp of event | 2018-07-27 14:06:27  |
| eventOutcome  |  basic outcome status | OK  |
|  eventOutcomeDetail | detailed outcome message  | SIP validated against expected structure   |
|  eventDetailCallingFunc |  pymm function or external library executing the event | ffmpeg ver.: 4.0.2   |
|  eventDetailCOMPUTER |  computer name | BAMPFA-iMac.local   |
|  linkingAgentIdentifierValue | generally name of operator running the ingest  | myUsername

### object

|  field name | purpose  | data example  |
| ------------ | ------------ | ------------ |
|  objectIdentifierValueID | unique DB id  | 118  |
| objectIdentifierValue   | basically the filename | filename.ext |
| objectCategory          | `file` or `intellectual entity`   | intellectual entity  |
| objectDB_Insertion      | timestamp for entry to DB      | 2018-07-27 14:06:27   |
| object_LastTouched      | timestamp for time object record last updated | 2018-07-27 14:06:27 |

### objectCharacteristics
|  field name | purpose  | data example  |
| ------------ | ------------ | ------------ |
|objectCharacteristicValueID|unique DB ID |16|
|objectIdentifierValueID|unique object ID from `objects` table|118|
|objectIdentifierValue|filename from `objects`|filename.ext|
|mediaInfo|text output from `mediainfo`|(just the raw mediainfo output)|
|ingestLog|text of ingestLog| recorded at the end of ingest for SIPs|
|pbcoreOutput|text of pbCore document for intellectual entity|same as above|
|pbcoreXML|pbcoore document as a BLOB| same as above (this isn't working now :( )|

### fixity
This table records fixity data for file objects as generated by a call to hashdeep that creates a manifest for the `objects` directory of a SIP.

|  field name | purpose  | data example  |
| ------------ | ------------ | ------------ |
| fixityIdentifierValue|unique DB ID|123|
|eventIdentifierValue|unique ID from `events` table|42|
|objectIdentifierValueID|unique ID from `objects` table|118|
|objectIdentifierValue|filename|filename.ext|
|eventDateTime|timestamp of event from `events`|2018-07-27 14:06:27|
|eventDetailCallingFunc|from `events` table|hashdeep|
|messageDigestAlgorithm|checksum algorithm|md5|
|messageDigestFilepath|filepath to object when it was checksummed|/path/to/file.ext|
|messageDigestHashValue|checksum value|4ee40a42df08da53260ae2f22c2c8b23|
|messageDigestSOURCE|checksum manifest this data comes from|/path/to/manifest.txt|